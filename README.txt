Регистратор показаний счетчиков воды и защита от протечек на Arduino. 
Работает с водосчетчиками, имеющими импульсный выход, и кранами от системы Нептун.
Возможности регистратора счетчика:
1.	Работа со счетчиками с импульсным выходом.
2.	Подсчет импульсов с двух или четырех счетчиков и вывод показаний на LCD дисплей. Подсветка дисплея включается одинарным нажатием кнопки.
3.	Наличие второго столбца показаний со сбрасываемыми значениями для подсчета расхода воды за период времени. Сброс осуществляется длительным нажатием кнопки.
4.	Сохранение данных в EEPROM на случай сбоя питания после протекания каждых 100 литров через счетчик, а также принудительно по тройному нажатию кнопки.
Возможности системы защиты от протечек:
1. Режим ручного управления кранами и автоматический режим. Нажатие кнопки выбора режима переключает режим работы авто/ручной. Имеются две дополнительных кнопки для управления кранами в ручном режиме.
2. Раздельное перекрывание воды при протечках в помещениях, обслуживаемых разными стояками.
3. Автоматическое закрывание\открывание кранов через определенный период времени с целью предотвращения их закисания.
4. Включение режима аварии через временную задержку в несколько секунд после намокания датчика. Требуется для того, чтобы система не срабатывала при кратковременном попадании мелких капель воды при приеме душа либо умывании.
5. Звуковая сигнализация аварии. Световая сигнализация конкретного датчика, с которого идет сигнал о протечке. Световая сигнализация режимов работы устройства и состояния кранов.
6. Возврат к последнему состоянию при перебоях питания.
Описание схемы:
Ко входам D2-D5 Ардуино нано подключены счетчики. S1 — холодная вода 1 стояк, S2 — горячая вода 1 стояк, S3 — холодная вода 2 стояк, S4 — горячая вода 2 стояк. Вторые контакты герконов подключены к минусу питания (массе).
Входы D6 и D7 подключены к цифровым выходам плат датчиков протечек, соответственно первая и вторая группы для помещений, обслуживаемых разными стояками. 
К входам D8, D9, D10, A2 подключены кнопки управления. S5 и S6 – управление первой и второй группой кранов соответственно. S7 – переключение между ручным и автоматическим режимом. Кнопка S8 отвечает за ряд функций: короткое нажатие – включение\выключение подсветки дисплея, нажатие с удержанием более 5 секунд – сброс показаний счетчиков за период, тройное нажатие – внеочередная запись текущих показаний в EEPROM перед отключением питания либо перезагрузкой устройства.
К выходу A1 подключен стандартный минидинамик, обычно применяемый в материнских платах для сигнализации состояния BIOS.
Помимо дисплея, информацию о состоянии прибора отображают ряд светодиодов:
LED1 – синий цвет, сигнализирует о включении ручного режима,
LED2 – красный цвет, сигнализирует об аварии,
LED3 и LED4 – зеленый цвет, сигнализирует об открытых кранах 1 и 2 группы соответственно,
LED5 – LED8 – желтый цвет, сигнализируют о срабатывании конкретного датчика протечки.
Отдельно хочу разобрать подключение кранов к реле. Тут возможны два варианта. В первом случае при срабатывании реле краны открываются, в другом — закрываются. Я выбрал для себя второй вариант с закрыванием при срабатывании, так как краны большую часть времени будут открыты, и реле при открытых кранах не будет потреблять ток и нагружать блок питания. Конечно, безопасность выше в первом случае. Но при желании настройки можно поменять, инвертировав соответствующие переменные в скетче, либо использовать модули реле со срабатыванием по низкому уровню. (В продаже имеются модули, срабатывающие как при нуле на входе, так и при единице. От этого зависит настройка прошивки.)
